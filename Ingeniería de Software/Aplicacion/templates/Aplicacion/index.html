<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Fluxe - Página principal</title>
  {% load static %}
  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/lux/bootstrap.min.css">
  <!-- Bootstrap-icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <!-- Sweetalert2 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.0/dist/sweetalert2.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <!-- moment library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <!-- Agregar jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  
  <link rel="stylesheet" href="{% static 'Aplicacion/style.css' %}">
  <link rel="icon" href="{% static 'Aplicacion/img/Fluxe.png' %}" type="image/png">

</head>

<body>
  <!-- Navigation bar -->
  <nav class="navbar d-flex nav-color justify-content-evenly fixed-top p-3">
    <h2 class="text-white m-0">Fluxe</h2>

    <div class="dropdown">
      <a href="#" class="link-light text-decoration-none dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="profile bi bi-person-circle text-light"> {{ username }}</i>
      </a>
      <ul class="dropdown-menu text-small">
        <li><a class="dropdown-item" href="{% url 'logout_user' %}">Cerrar Sesión</a></li>
      </ul>
    </div>    
  </nav>

  
  <div class="container-md text-center pt-5 app-container mt-5">
    <div class="d-flex justify-content-center toggle-funds" id="toggle-funds">
        <div class="dollar-sign mx-3">
          $ 
        </div>
        <div class="text-center">
          <div class="show-funds" id="funds">
           {{ amount }}
          </div>
        </div> 
        <div class="align-self-center mx-2">
          <i class="fa fa-eye-slash" id="toggle-funds-icon"></i>
        </div>
    </div>

    <div class="d-grid gap-2 col-4 m-auto py-1 sticky-button">
      <button class="btn btn-dark" type="button" onclick="window.location.href='transaction'">Añadir Transacción</button>
    </div>
    <hr class="custom-hr">
    
    <div class="container historial align-content-center">
      <h2> Historial </h2>
      {% load extras %}
      {% load widget_tweaks %}
      <div class="d-flex justify-content-end toggle-filter pointer-cursor" id="toggle-filter">
        <i class="bi bi-filter">Filtrar</i>
        <i class="bi bi-caret-down-fill mx-3 align-self-center" id="caret-down"></i>
        <i class="bi bi-caret-up-fill mx-3 align-self-center" id="caret-up"></i>
      </div>
      <!-- Formulario para el filtrado por categoría -->
      <div class="container filter px-2 py-2" id="filter">
        <div class="row justify-content-center">
          
          
          <div class="col-3 form-group date-range">
            <label for="date_from">Desde</label>
            <input class="form-control pointer-cursor" type="date" name="date_from" id="date_from" placeholder="" onchange="submitFilterForm()">
          </div>

          <div class="col-3 form-group date-range">
            <label for="date_to">Hasta</label>
            <input class="form-control pointer-cursor" type="date" name="date_to" id="date_to" onchange="submitFilterForm()">
          </div>

          <form class="col-4 mx-5" id="filter_form" method="post" data-filter-url="{% url 'filter_transactions' %}">
            {% csrf_token %}
            <div class="form-group date-range">
              <label for="filter_category">Categoría</label>
              <select class="form-select pointer-cursor" name="filter_category" id="filter_category" onchange="submitFilterForm()">
                <option value="">Seleccionar</option>
                <option value="all">Todas</option>
                <option value="home">Hogar</option>
                <option value="entertainment">Entretención</option>
                <option value="transfer">Transferencia</option>
                <option value="others">Otros</option>
              </select>
            </div>
          </form>
        </div>
      </div>

      <div id="transaction-container">
        <!-- Aquí se mostrarán las transacciones -->
        {% for transaction in transactions %}
        <div class="row justify-content-between mx-3 transaction" id="{{ transaction.id}}">
          <div class = "col-1 d-grid py-0 px-0">
              <div class="container">
                <a href="transaction/edit/{{transaction.id }}">
                <button class="btn bg-transparent border-0 w-100">
                  <i class="bi-p fa-lg bi-pencil-square"></i>
                </button>
                </a>
              </div>
              <div class="container">
                <button class="btn bg-transparent border-0 w-100" onclick="confirmDelete(this)" data-transaction-id="{{ transaction.id }}" data-delete-url="transaction/delete/{{transaction.id }}">
                  <i class="bi-t fa-lg bi-trash"></i>
                </button> 
              </div>
          </div>
          <div class="col">
            <div class="category">
              {{transaction.get_category_display}}
            </div>

            <div class="description">
              {{transaction.description}}
            </div>

            <div class="date">
              {{transaction.date|date:"d M Y"}}
            </div>

          </div>

          <div class="col-md-3 align-self-center ">
            {% if transaction.amount >  0 %}
            <div class="amount-income text-success">
              $<span id="formatted-amount-income" class="formatted-amount">{{ transaction.amount }}</span>
            </div>

            {% else %}
            <div class="amount-expenses text-danger">
              - $<span id="formatted-amount-expenses" class="formatted-amount">{{ transaction.amount|abs_value }}</span>
            </div>
            {% endif%}
          </div>

          <hr class="custom-hr">
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.0/dist/sweetalert2.min.js"></script>
  <script src="{% static 'Aplicacion/js/index.js' %}"></script>
  <script>
  </script>
</body>